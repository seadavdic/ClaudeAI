# Complete Architecture: Raspberry Pi Kubernetes Cluster

## ğŸŒ External Access Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          INTERNET / EXTERNAL                            â”‚
â”‚                                                                         â”‚
â”‚  ğŸ‘¤ User on Mobile/Work/Coffee Shop                                    â”‚
â”‚      â”‚                                                                  â”‚
â”‚      â”‚ HTTPS Request                                                   â”‚
â”‚      â–¼                                                                  â”‚
â”‚  ğŸŒ https://your-tunnel-name.trycloudflare.com                         â”‚
â”‚      â”‚                                                                  â”‚
â”‚      â”‚ Encrypted Tunnel                                                â”‚
â”‚      â–¼                                                                  â”‚
â”‚  â˜ï¸  Cloudflare Network                                                 â”‚
â”‚      â”‚ - TLS Termination                                               â”‚
â”‚      â”‚ - DDoS Protection                                               â”‚
â”‚      â”‚ - Global CDN                                                    â”‚
â”‚      â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Secure Tunnel (No Port Forwarding!)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ  HOME NETWORK (<network-subnet>)                   â”‚
â”‚                         Your Router                                     â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     ğŸ’» Windows PC (Management Station)            â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  ğŸ”§ Management Tools:                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ kubectl â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ Helm â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚ â”‚
â”‚  â”‚  â””â”€ Lens (Kubernetes IDE) â”€â”€â”€â”€â”¤                                  â”‚ â”‚
â”‚  â”‚                                â”‚                                  â”‚ â”‚
â”‚  â”‚  ğŸ“ hosts file:                â”‚                                  â”‚ â”‚
â”‚  â”‚  <cluster-ip> grafana.local    â”‚                                  â”‚ â”‚
â”‚  â”‚  <cluster-ip> prometheus.local                                    â”‚ â”‚
â”‚  â”‚  <cluster-ip> smartbiz.local   â”‚                                  â”‚ â”‚
â”‚  â”‚  <cluster-ip> api.local        â”‚                                  â”‚ â”‚
â”‚  â”‚  <cluster-ip> alertmanager.local                                  â”‚ â”‚
â”‚  â”‚                                â”‚                                  â”‚ â”‚
â”‚  â”‚  ğŸŒ Browser Access:            â”‚                                  â”‚ â”‚
â”‚  â”‚  http://grafana.local:30683 â—„â”€â”€â”˜                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚         â”‚ Kubernetes API (6443)                                        â”‚
â”‚         â”‚ HTTP Traffic (30683)                                         â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     ğŸ–¥ï¸  k3s-master (<master-ip>)                                â”‚   â”‚
â”‚  â”‚          Raspbian GNU/Linux 10 (ARMv7)                          â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚              âš™ï¸  k3s Control Plane                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Kubernetes API Server                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Scheduler                                            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Controller Manager                                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - etcd (cluster state)                                 â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚              ğŸ”„ Flux CD GitOps                          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  source-controller â”€â”¬â”€â–º ğŸ“¦ GitHub Repo                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  kustomize-controllerâ”‚   yourname/ClaudeAI             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  helm-controller â”€â”€â”€â”€â”˜                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Watches: ./apps/                                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Auto-deploys on Git commits                           â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚          ğŸš¦ Traefik Ingress Controller                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  NodePort: 30683 (HTTP)                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Routes traffic based on hostname                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  grafana.local â”€â”€â”€â”€â”€â–º grafana-grafana service          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  prometheus.local â”€â”€â–º prometheus-server service        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  smartbiz.local â”€â”€â”€â”€â–º smartbiz-ui service              â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚          ğŸ”€ MetalLB Controller                          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  IP Pool: <ip-range>                                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  (Not working on WiFi - Layer 2 ARP blocked)           â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  ğŸ“¡ Connection: WiFi (wlan0)                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚         â”‚ Kubernetes Cluster Network                                   â”‚
â”‚         â”‚ (Pod-to-Pod Communication)                                   â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     ğŸ–¥ï¸  k3s-worker-1 (<worker-ip>)                              â”‚   â”‚
â”‚  â”‚          Raspbian GNU/Linux 10 (ARMv7)                          â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚              âš™ï¸  k3s Worker Node                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - kubelet (manages pods)                               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - containerd (container runtime)                       â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  Running Pods:                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ“Š Grafana Pod                                      â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Container: grafana:latest                     â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Port: 3000                                    â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Namespace: grafana                            â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Monitoring & Dashboards                       â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Connected to Prometheus datasource            â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Connected to Loki datasource                  â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ“ˆ Prometheus Pod                                   â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Container: prometheus                         â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Port: 9090                                    â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Namespace: prometheus                         â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Scrapes metrics every 30s                     â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Persistent Volume: 5Gi (local-path)           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Retention: 2 days                             â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Data survives pod restarts                    â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ Metrics App Pod (Python)                         â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Image: python:3.9-slim                        â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Port: 8000 (/metrics endpoint)                â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Namespace: metrics-app                        â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Generates random web server metrics           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Updates every 60 seconds                      â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ“ Loki Pod (Log Aggregation)                       â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Container: loki                               â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Port: 3100                                    â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Namespace: loki                               â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Persistent Volume: 5Gi (local-path)           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Retention: 2 days                             â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Collects logs from all pods                   â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ” Promtail DaemonSet                               â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Runs on every node                            â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Scrapes pod logs                              â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Sends to Loki                                 â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Adds labels (namespace, pod, app)             â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ“‹ Log Generator Pod (Python)                       â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Image: python:3.9-slim                        â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Namespace: log-generator                      â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Generates structured JSON logs                â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Log levels: DEBUG, INFO, WARN, ERROR, CRITICALâ”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Simulates various scenarios                   â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸŒ REST API Pod (Flask)                             â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Image: python:3.9-slim                        â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Port: 5000                                    â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Namespace: rest-api                           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Ingress: http://api.local:30683               â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Endpoints: /health, /api/users, /api/process  â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Logs every request with duration              â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  â° Batch Job CronJob                                â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Image: python:3.9-slim                        â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Namespace: batch-job                          â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Schedule: Every 5 minutes                     â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Processes 50-200 records per run              â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Logs success/failure rates                    â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸŒ Cloudflared Pod (Tunnel)                         â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Image: erisamoe/cloudflared:latest            â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Creates secure tunnel to Cloudflare           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Proxies: grafana-grafana.svc:80               â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ No incoming ports needed!                     â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ—„ï¸  SmartBiz PostgreSQL Pod                          â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Image: postgres:15-alpine                     â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Port: 5432                                    â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Namespace: smartbiz                           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Persistent Volume: 5Gi (local-path)           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Database: smartbiz                            â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Tables: articles, customers, orders           â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ SmartBiz API Pod (FastAPI)                       â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Image: python:3.9-slim                        â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Port: 8000 (/metrics, /docs, CRUD endpoints)  â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Namespace: smartbiz                           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Business logic with SQLAlchemy ORM            â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Stock management & order processing           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Prometheus metrics integration                â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Auto stock reduction on orders                â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸŒ SmartBiz UI Pod (Nginx + SPA)                    â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Image: nginx:alpine                           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Port: 80                                      â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Namespace: smartbiz                           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Single-page app (vanilla JS)                  â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Forms for Articles, Customers, Orders         â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Stock adjustment UI (+/- buttons)             â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Ingress: http://smartbiz.local:30683          â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ External: Cloudflare Tunnel                   â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ”€ MetalLB Speaker Pod                              â”‚      â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Announces LoadBalancer IPs (L2)               â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  ğŸ“¡ Connection: WiFi (wlan0)                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ GitOps Deployment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GITOPS WORKFLOW                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  1ï¸âƒ£  Developer (You)                2ï¸âƒ£  GitHub                3ï¸âƒ£  Flux CD
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              â”‚                  â”‚              â”‚         â”‚              â”‚
  â”‚  Edit files  â”‚                  â”‚  Git Repo    â”‚         â”‚  Watches     â”‚
  â”‚  in apps/    â”‚  â”€â”€git pushâ”€â”€â–º   â”‚  yourname/   â”‚  â—„â”€â”€â”€â”  â”‚  repository  â”‚
  â”‚              â”‚                  â”‚  ClaudeAI    â”‚      â”‚  â”‚              â”‚
  â”‚              â”‚                  â”‚              â”‚      â”‚  â”‚  Detects     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚  changes     â”‚
                                           â”‚              â”‚  â”‚              â”‚
                                           â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚              â”‚         â”‚
                                           â”‚         polls every    â”‚
                                           â”‚           1 minute     â”‚
                                           â”‚              â”‚         â”‚
                                           â–¼              â”‚         â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  apps/       â”‚     â””â”€â”€â”‚  Reconciles  â”‚
                                    â”‚  â”œâ”€grafana/  â”‚        â”‚  cluster     â”‚
                                    â”‚  â”œâ”€prometheusâ”‚        â”‚  state       â”‚
                                    â”‚  â”œâ”€metrics-app        â”‚              â”‚
                                    â”‚  â”œâ”€metallb/  â”‚        â”‚              â”‚
                                    â”‚  â””â”€cloudflared/      â”‚              â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                   â”‚
                                                                   â”‚
                                                                   â–¼
  4ï¸âƒ£  Kubernetes Cluster          â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  Applies changes
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            automatically!
  â”‚  ğŸ“Š Grafana                â”‚
  â”‚  ğŸ“ˆ Prometheus             â”‚
  â”‚  ğŸ Metrics App            â”‚
  â”‚  ğŸ”€ MetalLB                â”‚
  â”‚  ğŸŒ Cloudflared            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Network Traffic Flow

### Local Network Access
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Your Browser â”‚
â”‚ (Windows PC) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. DNS: grafana.local â†’ <cluster-ip>
       â”‚    (from hosts file)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <cluster-ip>:30683   â”‚
â”‚ (k3s-master)         â”‚
â”‚                      â”‚
â”‚  Traefik Ingress     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Route based on hostname
       â”‚    Host: grafana.local
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ grafana-grafana Serviceâ”‚
â”‚ ClusterIP: 10.43.52.82 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Load balance to pod
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Grafana Pod         â”‚
â”‚  Port: 3000          â”‚
â”‚  (Worker Node)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### External Access (Internet)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Internet User      â”‚
â”‚ (Mobile/Work)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. HTTPS Request
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ https://your-tunnel-name.        â”‚
â”‚ trycloudflare.com                â”‚
â”‚                                  â”‚
â”‚ Cloudflare Edge Network          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 2. Secure tunnel (QUIC protocol)
         â”‚    Encrypted, no port forwarding
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflared Pod (Worker)     â”‚
â”‚ Outbound connection only     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. Internal proxy
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ grafana-grafana.grafana.svc  â”‚
â”‚ :80                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Grafana Pod                  â”‚
â”‚ Returns dashboard            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Metrics & Monitoring Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   METRICS COLLECTION PIPELINE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Step 1: Metrics Generation
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ Metrics App (Python)             â”‚
  â”‚                                      â”‚
  â”‚  Every 60 seconds:                   â”‚
  â”‚  â”œâ”€ Generate 10-50 random requests   â”‚
  â”‚  â”œâ”€ Simulate response times          â”‚
  â”‚  â”œâ”€ Simulate errors (400, 500)       â”‚
  â”‚  â””â”€ Update active connections        â”‚
  â”‚                                      â”‚
  â”‚  Exposes metrics on:                 â”‚
  â”‚  http://metrics-app:8000/metrics     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Metrics in Prometheus format
                 â”‚ (Counters, Gauges, Histograms)
                 â”‚
                 â–¼
  Step 2: Metrics Scraping
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ“ˆ Prometheus Server                â”‚
  â”‚                                      â”‚
  â”‚  Scrape interval: 30 seconds         â”‚
  â”‚  Target: metrics-app.metrics-app     â”‚
  â”‚          .svc.cluster.local:8000     â”‚
  â”‚                                      â”‚
  â”‚  Collected metrics:                  â”‚
  â”‚  â”œâ”€ http_requests_total              â”‚
  â”‚  â”œâ”€ http_request_duration_seconds    â”‚
  â”‚  â”œâ”€ http_active_connections          â”‚
  â”‚  â””â”€ http_errors_total                â”‚
  â”‚                                      â”‚
  â”‚  Stored as time-series data          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ PromQL queries
                 â”‚
                 â–¼
  Step 3: Visualization
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ“Š Grafana Dashboard                â”‚
  â”‚                                      â”‚
  â”‚  Datasource: Prometheus              â”‚
  â”‚  http://prometheus-prometheus-       â”‚
  â”‚  server.prometheus.svc:80            â”‚
  â”‚                                      â”‚
  â”‚  8 Dashboard Panels:                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ 1. Total Requests (Counter)    â”‚  â”‚
  â”‚  â”‚ 2. Active Connections (Gauge)  â”‚  â”‚
  â”‚  â”‚ 3. Request Rate (Graph)        â”‚  â”‚
  â”‚  â”‚ 4. Requests by Status (Graph)  â”‚  â”‚
  â”‚  â”‚ 5. Duration p50/p95/p99 (Graph)â”‚  â”‚
  â”‚  â”‚ 6. Error Rate by Type (Graph)  â”‚  â”‚
  â”‚  â”‚ 7. Total Errors (Counter)      â”‚  â”‚
  â”‚  â”‚ 8. Requests by Endpoint (Pie)  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                      â”‚
  â”‚  Auto-refresh: 30 seconds            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ HTTP
                 â”‚
                 â–¼
  Step 4: User Access
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ‘¤ User's Browser                   â”‚
  â”‚                                      â”‚
  â”‚  Local: http://grafana.local:30683   â”‚
  â”‚  External: https://[tunnel].         â”‚
  â”‚           trycloudflare.com          â”‚
  â”‚                                      â”‚
  â”‚  View real-time web server metrics   â”‚
  â”‚  with beautiful visualizations!      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ Installation Journey (Step by Step)

```
START
  â”‚
  â”œâ”€â–º Step 1: SSH Setup
  â”‚   â”œâ”€ Changed pi user password
  â”‚   â”œâ”€ Generated SSH keys
  â”‚   â”œâ”€ Copied public key to both Pis
  â”‚   â””â”€ âœ… Password-less SSH access
  â”‚
  â”œâ”€â–º Step 2: Network Configuration
  â”‚   â”œâ”€ Set static IPs (<master-ip>, <worker-ip>)
  â”‚   â”œâ”€ Identified WiFi interface (wlan0)
  â”‚   â””â”€ âœ… Stable network addresses
  â”‚
  â”œâ”€â–º Step 3: k3s Installation
  â”‚   â”œâ”€ Master: k3s server on k3s-master (<master-ip>)
  â”‚   â”œâ”€ Worker: k3s agent joins cluster on k3s-worker-1
  â”‚   â”œâ”€ FIX: Auto-detect network interface (wlan0)
  â”‚   â””â”€ âœ… 2-node Kubernetes cluster
  â”‚
  â”œâ”€â–º Step 4: Windows Management Setup
  â”‚   â”œâ”€ Install kubectl
  â”‚   â”œâ”€ Install Helm
  â”‚   â”œâ”€ Install Lens
  â”‚   â”œâ”€ Copy kubeconfig from master
  â”‚   â””â”€ âœ… Remote cluster management
  â”‚
  â”œâ”€â–º Step 5: Flux CD (GitOps)
  â”‚   â”œâ”€ Bootstrap Flux to GitHub
  â”‚   â”œâ”€ Create apps/ directory structure
  â”‚   â”œâ”€ Configure Kustomization to watch apps/
  â”‚   â”œâ”€ ISSUE: Argo CD doesn't support ARM32
  â”‚   â”œâ”€ SOLUTION: Use Flux CD instead
  â”‚   â””â”€ âœ… GitOps automation
  â”‚
  â”œâ”€â–º Step 6: Grafana Deployment
  â”‚   â”œâ”€ Create helmrelease.yaml
  â”‚   â”œâ”€ Commit to Git
  â”‚   â”œâ”€ Flux auto-deploys
  â”‚   â””â”€ âœ… Grafana running
  â”‚
  â”œâ”€â–º Step 7: MetalLB LoadBalancer
  â”‚   â”œâ”€ Create MetalLB manifests
  â”‚   â”œâ”€ Configure IP pool (210-230)
  â”‚   â”œâ”€ Deploy via GitOps
  â”‚   â”œâ”€ ISSUE: Layer 2 doesn't work on WiFi
  â”‚   â””â”€ âš ï¸  NodePort works as alternative
  â”‚
  â”œâ”€â–º Step 8: Traefik Ingress
  â”‚   â”œâ”€ Create ingress.yaml for Grafana
  â”‚   â”œâ”€ Configure hostname: grafana.local
  â”‚   â”œâ”€ Add to Windows hosts file
  â”‚   â””â”€ âœ… Clean URL: http://grafana.local:30683
  â”‚
  â”œâ”€â–º Step 9: Cloudflare Tunnel
  â”‚   â”œâ”€ Create cloudflared deployment
  â”‚   â”œâ”€ ISSUE: Official image no ARM32 support
  â”‚   â”œâ”€ SOLUTION: Use erisamoe/cloudflared
  â”‚   â”œâ”€ ISSUE: Liveness probe failing
  â”‚   â”œâ”€ FIX: Remove liveness probe
  â”‚   â””â”€ âœ… Public access: https://your-tunnel-name.trycloudflare.com
  â”‚
  â”œâ”€â–º Step 10: Prometheus Monitoring
  â”‚   â”œâ”€ Create prometheus HelmRelease
  â”‚   â”œâ”€ Create Ingress for Prometheus UI
  â”‚   â”œâ”€ Configure prometheus.local hostname
  â”‚   â”œâ”€ ISSUE: Wrong service name in Ingress
  â”‚   â”œâ”€ FIX: Use prometheus-prometheus-server
  â”‚   â””â”€ âœ… Prometheus UI: http://prometheus.local:30683
  â”‚
  â”œâ”€â–º Step 11: Metrics Generator App
  â”‚   â”œâ”€ Create Python app with prometheus_client
  â”‚   â”œâ”€ Generate random web server metrics
  â”‚   â”œâ”€ Deploy via ConfigMap (embedded code)
  â”‚   â”œâ”€ Create Service and Namespace
  â”‚   â”œâ”€ Configure Prometheus scrape target
  â”‚   â”œâ”€ Create kustomization.yaml for GitOps
  â”‚   â””â”€ âœ… Metrics app generates data every 60s
  â”‚
  â””â”€â–º Step 12: Grafana Dashboard
      â”œâ”€ Configure Prometheus as datasource
      â”œâ”€ Create Web Server Metrics dashboard
      â”œâ”€ Add 8 visualization panels:
      â”‚   â”œâ”€ Counters (Total Requests, Errors)
      â”‚   â”œâ”€ Gauge (Active Connections)
      â”‚   â”œâ”€ Graphs (Rate, Status, Duration, Errors)
      â”‚   â””â”€ Pie Chart (Requests by Endpoint)
      â”œâ”€ Deploy via ConfigMap
      â””â”€ âœ… Complete monitoring stack operational
END
```

---

## ğŸ“¦ Repository Structure

```
yourname/ClaudeAI/
â”‚
â”œâ”€â”€ ğŸ“ apps/                                    â† Application Deployments
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ grafana/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ helmrepository.yaml             â† Grafana Helm repo
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ helmrelease.yaml                â† Grafana config + Prometheus datasource
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ingress.yaml                    â† Traefik ingress rules
â”‚   â”‚   â””â”€â”€ ğŸ“„ dashboard-configmap.yaml        â† Web Server Metrics dashboard
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ prometheus/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ helmrepository.yaml             â† Prometheus community Helm repo
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ helmrelease.yaml                â† Prometheus + scrape configs
â”‚   â”‚   â””â”€â”€ ğŸ“„ ingress.yaml                    â† Prometheus UI ingress
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ metrics-app/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ kustomization.yaml              â† Kustomize config for GitOps
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ namespace.yaml                  â† metrics-app namespace
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ deployment.yaml                 â† Python app + ConfigMap
â”‚   â”‚   â””â”€â”€ ğŸ“„ service.yaml                    â† Service exposing /metrics
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ metallb/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ namespace.yaml                  â† metallb-system namespace
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ helmrepository.yaml             â† MetalLB Helm repo
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ helmrelease.yaml                â† MetalLB deployment
â”‚   â”‚   â””â”€â”€ ğŸ“„ ippool.yaml                     â† IP pool + L2 advertisement
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ cloudflared/
â”‚   â”‚   â””â”€â”€ ğŸ“„ deployment.yaml                 â† Cloudflare Tunnel
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ smartbiz-db/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ namespace.yaml                  â† smartbiz namespace
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ secret.yaml                     â† PostgreSQL credentials
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ deployment.yaml                 â† PostgreSQL 15 Alpine
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ service.yaml                    â† Database service
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ pvc.yaml                        â† 5Gi persistent storage
â”‚   â”‚   â””â”€â”€ ğŸ“„ kustomization.yaml              â† Kustomize config
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ smartbiz-api/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ configmap.yaml                  â† FastAPI application code
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ requirements.yaml               â† Python dependencies
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ deployment.yaml                 â† API pod with probes
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ service.yaml                    â† API service
â”‚   â”‚   â””â”€â”€ ğŸ“„ kustomization.yaml              â† Kustomize config
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ smartbiz-ui/
â”‚       â”œâ”€â”€ ğŸ“„ configmap.yaml                  â† HTML + CSS + JavaScript
â”‚       â”œâ”€â”€ ğŸ“„ nginx-config.yaml               â† Nginx reverse proxy config
â”‚       â”œâ”€â”€ ğŸ“„ deployment.yaml                 â† Nginx pod
â”‚       â”œâ”€â”€ ğŸ“„ service.yaml                    â† UI service
â”‚       â”œâ”€â”€ ğŸ“„ ingress.yaml                    â† Traefik ingress
â”‚       â”œâ”€â”€ ğŸ“„ cloudflared-deployment.yaml     â† Public tunnel
â”‚       â””â”€â”€ ğŸ“„ kustomization.yaml              â† Kustomize config
â”‚
â”œâ”€â”€ ğŸ“ clusters/my-cluster/                     â† Flux Configuration
â”‚   â”œâ”€â”€ ğŸ“ flux-system/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ gotk-components.yaml            â† Flux controllers
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ gotk-sync.yaml                  â† Git sync config
â”‚   â”‚   â””â”€â”€ ğŸ“„ kustomization.yaml              â† Flux system kustomization
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“„ apps-kustomization.yaml             â† Watches ./apps/ folder
â”‚
â””â”€â”€ ğŸ“ k3s-setup/                               â† Installation Scripts
    â”œâ”€â”€ ğŸ“ scripts/
    â”‚   â”œâ”€â”€ ğŸ“„ 00-prerequisites.sh             â† System prep
    â”‚   â”œâ”€â”€ ğŸ“„ 01-install-master.sh            â† k3s master installation
    â”‚   â”œâ”€â”€ ğŸ“„ 02-install-worker.sh            â† k3s worker installation
    â”‚   â””â”€â”€ ğŸ“„ 03-verify-cluster.sh            â† Cluster verification
    â”‚
    â”œâ”€â”€ ğŸ“„ README.md                            â† Setup overview
    â””â”€â”€ ğŸ“„ INSTALLATION-GUIDE.md                â† Detailed guide
```

---

## ğŸ”§ Technology Stack Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APPLICATION LAYER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Grafana   â”‚  â”‚ Prometheus â”‚  â”‚  Metrics   â”‚                â”‚
â”‚  â”‚ Dashboards â”‚  â”‚  Metrics   â”‚  â”‚    App     â”‚                â”‚
â”‚  â”‚            â”‚  â”‚  Storage   â”‚  â”‚  (Python)  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚       â”‚                 â–²                â”‚                      â”‚
â”‚       â””â”€â”€â”€â”€â”€queriesâ”€â”€â”€â”€â”€â”˜                â”‚                      â”‚
â”‚                                          â”‚                      â”‚
â”‚                    â—„â”€â”€â”€â”€â”€â”€scrapesâ”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NETWORKING LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Traefik    â”‚  â”‚   MetalLB    â”‚  â”‚  Cloudflare  â”‚          â”‚
â”‚  â”‚   Ingress    â”‚  â”‚ LoadBalancer â”‚  â”‚    Tunnel    â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ IP Pool:     â”‚  â”‚ Public HTTPS â”‚          â”‚
â”‚  â”‚ â”‚hostname  â”‚ â”‚  â”‚ 210-230      â”‚  â”‚ Access       â”‚          â”‚
â”‚  â”‚ â”‚routing   â”‚ â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ORCHESTRATION LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚         Kubernetes (k3s v1.34.3)                 â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚  â”‚  â”‚ API Server â”‚  â”‚ Scheduler  â”‚  â”‚ Controller â”‚ â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚         Flux CD (GitOps)                         â”‚           â”‚
â”‚  â”‚  source â†’ kustomize â†’ helm controllers           â”‚           â”‚
â”‚  â”‚  Auto-sync with GitHub every 1 minute            â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CONTAINER LAYER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚         containerd v2.1.5-k3s1                   â”‚           â”‚
â”‚  â”‚  - Container runtime                             â”‚           â”‚
â”‚  â”‚  - Image pulling                                 â”‚           â”‚
â”‚  â”‚  - Pod lifecycle management                      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OPERATING SYSTEM                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚      Raspbian GNU/Linux 10 (Buster)              â”‚           â”‚
â”‚  â”‚      Kernel: 5.10.103-v7l+                       â”‚           â”‚
â”‚  â”‚      Architecture: ARMv7 (32-bit)                â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HARDWARE LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  k3s-master        â”‚        â”‚  k3s-worker-1      â”‚           â”‚
â”‚  â”‚  Raspberry Pi 4B   â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚  Raspberry Pi 4B   â”‚           â”‚
â”‚  â”‚  <master-ip>       â”‚  WiFi  â”‚  <worker-ip>       â”‚           â”‚
â”‚  â”‚  wlan0             â”‚        â”‚  wlan0             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Access Points Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 HOW TO ACCESS YOUR SERVICES                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ“Š GRAFANA (Dashboards & Visualizations)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Local:  http://grafana.local:30683                      â”‚
  â”‚  External: https://[tunnel].trycloudflare.com            â”‚
  â”‚                                                          â”‚
  â”‚  ğŸ” Login:                                               â”‚
  â”‚    Username: admin                                       â”‚
  â”‚    Password: <your-grafana-password>                     â”‚
  â”‚                                                          â”‚
  â”‚  Features:                                               â”‚
  â”‚  â”œâ”€ Web Server Metrics dashboard                         â”‚
  â”‚  â”œâ”€ Real-time data (30s refresh)                         â”‚
  â”‚  â””â”€ 8 visualization panels                               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ“ˆ PROMETHEUS (Metrics & Time-Series DB)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Local:  http://prometheus.local:30683                   â”‚
  â”‚                                                          â”‚
  â”‚  Features:                                               â”‚
  â”‚  â”œâ”€ Query metrics with PromQL                            â”‚
  â”‚  â”œâ”€ View targets (Status â†’ Targets)                     â”‚
  â”‚  â”œâ”€ Explore collected metrics                            â”‚
  â”‚  â””â”€ See scrape configurations                            â”‚
  â”‚                                                          â”‚
  â”‚  No authentication required (internal use)               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ METRICS APP (Metrics Generator)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Endpoint: http://metrics-app.metrics-app.svc:8000       â”‚
  â”‚  Metrics:  http://metrics-app.metrics-app.svc:8000/      â”‚
  â”‚            metrics                                       â”‚
  â”‚                                                          â”‚
  â”‚  Internal service - scraped by Prometheus every 30s      â”‚
  â”‚  Generates random web server metrics every 60s           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸª SMARTBIZ (Business Management Application)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Local:  http://smartbiz.local:30683                     â”‚
  â”‚  External: https://leslie-shortcuts-jokes-cart.          â”‚
  â”‚            trycloudflare.com                             â”‚
  â”‚                                                          â”‚
  â”‚  Features:                                               â”‚
  â”‚  â”œâ”€ Manage Articles (with stock tracking)                â”‚
  â”‚  â”œâ”€ Manage Customers                                     â”‚
  â”‚  â”œâ”€ Create Orders (auto stock reduction)                 â”‚
  â”‚  â”œâ”€ Stock adjustment UI (+10, +1, -1, -10)               â”‚
  â”‚  â””â”€ Business metrics in Grafana dashboard                â”‚
  â”‚                                                          â”‚
  â”‚  Backend:                                                â”‚
  â”‚  â”œâ”€ FastAPI + PostgreSQL 15                              â”‚
  â”‚  â”œâ”€ Prometheus metrics at /metrics                       â”‚
  â”‚  â””â”€ API docs at /docs                                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ’¡ REQUIREMENTS FOR LOCAL ACCESS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Add to Windows hosts file:                              â”‚
  â”‚  C:\Windows\System32\drivers\etc\hosts                   â”‚
  â”‚                                                          â”‚
  â”‚  <cluster-ip> grafana.local                              â”‚
  â”‚  <cluster-ip> prometheus.local                           â”‚
  â”‚  <cluster-ip> smartbiz.local                             â”‚
  â”‚  <cluster-ip> api.local                                  â”‚
  â”‚  <cluster-ip> alertmanager.local                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Process Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            FROM CODE COMMIT TO RUNNING APPLICATION              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â±ï¸  Time: ~1-2 minutes (automatic!)

  Step 1: Developer Action
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ $ git add apps/    â”‚
  â”‚ $ git commit -m "" â”‚
  â”‚ $ git push         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Pushes to GitHub
            â–¼
  Step 2: GitHub Repository
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Repository updated         â”‚
  â”‚ Commit SHA: abc123...      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Flux polls every 1min
            â–¼
  Step 3: Flux Detection
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ source-controller detects  â”‚
  â”‚ new commit                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Pulls changes
            â–¼
  Step 4: Flux Processing
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ kustomize-controller       â”‚
  â”‚ processes ./apps/          â”‚
  â”‚                            â”‚
  â”‚ helm-controller            â”‚
  â”‚ processes HelmReleases     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Applies to cluster
            â–¼
  Step 5: Kubernetes Apply
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ kubectl apply -f ...       â”‚
  â”‚ (automatically!)           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Creates/Updates resources
            â–¼
  Step 6: Resource Creation
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Deployments                â”‚
  â”‚ Services                   â”‚
  â”‚ Ingresses                  â”‚
  â”‚ ConfigMaps                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Scheduler assigns pods
            â–¼
  Step 7: Pod Scheduling
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Scheduler picks node       â”‚
  â”‚ (master or worker)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ kubelet starts pod
            â–¼
  Step 8: Container Runtime
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ containerd pulls image     â”‚
  â”‚ Creates container          â”‚
  â”‚ Starts process             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Application ready
            â–¼
  Step 9: Service Ready
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ âœ… Pod running              â”‚
  â”‚ âœ… Service routing traffic  â”‚
  â”‚ âœ… Ingress configured       â”‚
  â”‚ âœ… Publicly accessible      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Troubleshooting Reference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROBLEMS SOLVED                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  âŒ Problem: Worker node can't join cluster
  â”œâ”€ Cause: Hardcoded eth0 interface, but using WiFi (wlan0)
  â””â”€ âœ… Solution: Auto-detect network interface in scripts

  âŒ Problem: kubectl can't connect
  â”œâ”€ Cause: Wrong server IP in kubeconfig (127.0.0.1)
  â””â”€ âœ… Solution: Change to master IP (k3s-master: <master-ip>)

  âŒ Problem: Argo CD ImagePullBackOff
  â”œâ”€ Cause: Argo CD doesn't support ARM32 (ARMv7)
  â””â”€ âœ… Solution: Use Flux CD instead (ARM32 compatible)

  âŒ Problem: Flux not deploying apps
  â”œâ”€ Cause: Only watching ./clusters/my-cluster path
  â””â”€ âœ… Solution: Create Kustomization to watch ./apps

  âŒ Problem: Grafana chart version not found
  â”œâ”€ Cause: Specified version 11.3.0 doesn't exist
  â””â”€ âœ… Solution: Remove version, use latest

  âŒ Problem: SSH requires password every time
  â”œâ”€ Cause: No SSH key authentication
  â””â”€ âœ… Solution: ssh-keygen + ssh-copy-id

  âŒ Problem: MetalLB LoadBalancer IP not reachable
  â”œâ”€ Cause: WiFi blocks Layer 2 ARP announcements
  â””â”€ âœ… Solution: Use NodePort or Cloudflare Tunnel

  âŒ Problem: Cloudflared ImagePullBackOff
  â”œâ”€ Cause: Official image doesn't support ARM32
  â””â”€ âœ… Solution: Use erisamoe/cloudflared community image

  âŒ Problem: Cloudflared CrashLoopBackOff
  â”œâ”€ Cause: Liveness probe fails (no /ready endpoint)
  â””â”€ âœ… Solution: Remove liveness probe from deployment
```

---

## ğŸ“ˆ Current Stack & Future Expansion

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHAT YOU HAVE NOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  âœ… IMPLEMENTED:
  â”œâ”€ k3s Kubernetes cluster (2 nodes)
  â”œâ”€ Flux CD GitOps automation
  â”œâ”€ Traefik Ingress Controller
  â”œâ”€ Cloudflare Tunnel (public access)
  â”œâ”€ Grafana (dashboards & visualization)
  â”œâ”€ Prometheus (metrics collection & storage)
  â”œâ”€ Loki (log aggregation & storage)
  â”œâ”€ Promtail (log collection agent)
  â”œâ”€ Custom Metrics App (Python)
  â”œâ”€ Log Generator App (multi-level logs)
  â”œâ”€ REST API (Flask with rich logging)
  â”œâ”€ Batch Job Simulator (CronJob)
  â”œâ”€ SmartBiz Application (Full-stack business app)
  â”‚   â”œâ”€ PostgreSQL database (15 Alpine)
  â”‚   â”œâ”€ FastAPI backend (CRUD + metrics)
  â”‚   â”œâ”€ Single-page UI (Nginx + vanilla JS)
  â”‚   â”œâ”€ Stock management system
  â”‚   â”œâ”€ Business metrics dashboard (Grafana)
  â”‚   â””â”€ Public access via Cloudflare Tunnel
  â””â”€ Complete observability stack (metrics + logs)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  WHAT YOU CAN ADD NEXT                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸŒ Applications
  â”œâ”€ WordPress blog
  â”œâ”€ NextCloud (file storage)
  â”œâ”€ Home Assistant (home automation)
  â”œâ”€ Plex/Jellyfin (media server)
  â””â”€ Your custom apps!

  ğŸ”’ Security
  â”œâ”€ cert-manager (automatic SSL certificates)
  â”œâ”€ OAuth2 Proxy (authentication)
  â”œâ”€ Secrets Management
  â”‚  â”œâ”€ Kubernetes Secrets (base64-encoded, basic protection)
  â”‚  â”œâ”€ Sealed Secrets (encrypted, GitOps-safe)
  â”‚  â”œâ”€ HashiCorp Vault (enterprise-grade, dynamic secrets)
  â”‚  â””â”€ External Secrets Operator (sync from external stores)
  â””â”€ Network Policies (pod firewall)

  ğŸš€ CI/CD Pipeline
  â”œâ”€ Tekton Pipelines (cloud-native CI/CD)
  â”œâ”€ GitLab Runner (self-hosted CI)
  â”œâ”€ Argo Workflows (workflow engine)
  â””â”€ Harbor (container registry)

  âš¡ Serverless & Functions
  â”œâ”€ OpenFaaS (functions as a service)
  â”œâ”€ Knative Serving (serverless containers)
  â”œâ”€ KEDA (event-driven autoscaling)
  â””â”€ Nuclio (high-performance functions)

  ğŸ”„ Backup & Recovery
  â”œâ”€ Velero (cluster backup/restore)
  â”œâ”€ Stash (backup operator)
  â”œâ”€ Automated database backups
  â””â”€ Disaster recovery procedures

  All deployed via GitOps - just commit to Git! ğŸš€
```

---

## ğŸ° RabbitMQ Order Processing Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              EVENT-DRIVEN ORDER PROCESSING ARCHITECTURE                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ“¨ Message Broker: RabbitMQ 3.13-management-alpine
  ğŸ—ï¸  Architecture: Fanout Exchange Pattern
  ğŸ”„ Message Flow: Orders â†’ Payments â†’ Fulfillment â†’ Notifications
  âš¡ Throughput: 1-5 orders every 10-20 seconds (configurable)
  ğŸ“Š Success Rate: ~90% payment success (realistic simulation)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RABBITMQ CORE DEPLOYMENT                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ° RabbitMQ Pod (Namespace: rabbitmq)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Image: rabbitmq:3.13-management-alpine                        â”‚
  â”‚  Architecture: ARM32 compatible                                â”‚
  â”‚                                                                â”‚
  â”‚  Ports:                                                        â”‚
  â”‚  â”œâ”€ 5672  (AMQP protocol)                                     â”‚
  â”‚  â”œâ”€ 15672 (Management UI)                                     â”‚
  â”‚  â””â”€ 15692 (Prometheus metrics)                                â”‚
  â”‚                                                                â”‚
  â”‚  Credentials:                                                  â”‚
  â”‚  â”œâ”€ User: admin                                               â”‚
  â”‚  â””â”€ Pass: ***                                                 â”‚
  â”‚                                                                â”‚
  â”‚  Resources:                                                    â”‚
  â”‚  â”œâ”€ CPU: 250m request, 1000m limit                            â”‚
  â”‚  â””â”€ Memory: 512Mi request, 1Gi limit                          â”‚
  â”‚                                                                â”‚
  â”‚  Plugins Enabled:                                              â”‚
  â”‚  â”œâ”€ rabbitmq_management (Web UI)                              â”‚
  â”‚  â””â”€ rabbitmq_prometheus (Metrics exporter)                    â”‚
  â”‚                                                                â”‚
  â”‚  Access Points:                                                â”‚
  â”‚  â”œâ”€ Internal: rabbitmq.rabbitmq.svc.cluster.local:5672        â”‚
  â”‚  â”œâ”€ Management UI: http://rabbitmq.local:30683                â”‚
  â”‚  â””â”€ Metrics: http://rabbitmq.rabbitmq.svc:15692/metrics       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MESSAGE FLOW ARCHITECTURE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Step 1: Order Generation
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ“ Order Generator Service         â”‚
  â”‚                                     â”‚
  â”‚  Every 10-20 seconds:               â”‚
  â”‚  â”œâ”€ Generate 1-5 orders             â”‚
  â”‚  â”œâ”€ Customer: Random from 6 users   â”‚
  â”‚  â”œâ”€ Products: 1-3 items per order   â”‚
  â”‚  â”œâ”€ Amount: â‚¬99.99 - â‚¬3000+         â”‚
  â”‚  â””â”€ Publish to 'orders' exchange    â”‚
  â”‚                                     â”‚
  â”‚  Queue: N/A (Publisher only)        â”‚
  â”‚  Exchange: orders (fanout)          â”‚
  â”‚  Metrics Port: 8000                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Message: Order JSON
                 â”‚ {order_id, customer_email, items[], total_amount...}
                 â”‚
                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ”€ Exchange: 'orders'                 â”‚
  â”‚  Type: fanout (broadcasts to all)     â”‚
  â”‚  Durable: true                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Fanout to bound queues
             â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                          â”‚
             â–¼                          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ payment_processor_  â”‚    â”‚ notifications_orders_    â”‚
  â”‚ queue               â”‚    â”‚ queue                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                           â”‚
            â”‚                           â”‚
            â–¼                           â–¼
  Step 2a: Payment Processing   Step 2b: Order Notifications
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ’³ Payment Service       â”‚  â”‚ ğŸ“§ Notification Service â”‚
  â”‚                          â”‚  â”‚                         â”‚
  â”‚ Replicas: 2 (HA)         â”‚  â”‚ Sends email/SMS:        â”‚
  â”‚ Success Rate: 90%        â”‚  â”‚ "Order #X received"     â”‚
  â”‚ Processing: 0.5-2.0s     â”‚  â”‚                         â”‚
  â”‚                          â”‚  â”‚ Multi-threaded:         â”‚
  â”‚ On Success:              â”‚  â”‚ Consumes 3 exchanges    â”‚
  â”‚ â”œâ”€ Generate TXN ID       â”‚  â”‚ simultaneously          â”‚
  â”‚ â”œâ”€ Select payment method â”‚  â”‚                         â”‚
  â”‚ â””â”€ Publish to 'payments' â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                          â”‚
  â”‚ On Failure (10%):        â”‚
  â”‚ â”œâ”€ Random failure reason â”‚
  â”‚ â””â”€ Still publish result  â”‚
  â”‚                          â”‚
  â”‚ Metrics Port: 8001       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Message: Payment Result JSON
             â”‚ {order_id, status, amount, txn_id, failure_reason...}
             â”‚
             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ”€ Exchange: 'payments'               â”‚
  â”‚  Type: fanout                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Fanout to bound queues
             â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                          â”‚
             â–¼                          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ fulfillment_processor_â”‚  â”‚ notifications_payments_  â”‚
  â”‚ queue                 â”‚  â”‚ queue                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                           â”‚
            â”‚                           â”‚
            â–¼                           â–¼
  Step 3a: Fulfillment        Step 3b: Payment Notifications
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ“¦ Fulfillment       â”‚    â”‚ ğŸ“§ Notification Service â”‚
  â”‚    Service           â”‚    â”‚                         â”‚
  â”‚                      â”‚    â”‚ Sends email/SMS:        â”‚
  â”‚ Filters:             â”‚    â”‚ "Payment successful"    â”‚
  â”‚ â”œâ”€ Only success      â”‚    â”‚ OR                      â”‚
  â”‚ â””â”€ Skip failed       â”‚    â”‚ "Payment failed: reason"â”‚
  â”‚                      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚ Processing: 1-3s     â”‚
  â”‚ Creates:             â”‚
  â”‚ â”œâ”€ Tracking number   â”‚
  â”‚ â”œâ”€ Carrier selection â”‚
  â”‚ â”œâ”€ Delivery estimate â”‚
  â”‚ â””â”€ Shipment record   â”‚
  â”‚                      â”‚
  â”‚ Publishes to         â”‚
  â”‚ 'shipments' exchange â”‚
  â”‚                      â”‚
  â”‚ Metrics Port: 8002   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Message: Shipment JSON
             â”‚ {order_id, tracking_number, carrier, est_delivery...}
             â”‚
             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ”€ Exchange: 'shipments'              â”‚
  â”‚  Type: fanout                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Fanout to bound queues
             â”‚
             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ notifications_shipments_ â”‚
  â”‚ queue                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚
             â–¼
  Step 4: Shipment Notifications
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ“§ Notification Service  â”‚
  â”‚                          â”‚
  â”‚ Sends email/SMS:         â”‚
  â”‚ "Order shipped!"         â”‚
  â”‚ "Tracking: TRACK-X-Y"    â”‚
  â”‚                          â”‚
  â”‚ Metrics Port: 8003       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        QUEUE STRUCTURE                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Named Queues (Visible in RabbitMQ UI):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  1ï¸âƒ£  payment_processor_queue                                â”‚
  â”‚      â”œâ”€ Bound to: orders exchange                           â”‚
  â”‚      â”œâ”€ Consumer: payment-service (2 replicas)              â”‚
  â”‚      â”œâ”€ Purpose: Process order payments                     â”‚
  â”‚      â””â”€ Durable: true                                       â”‚
  â”‚                                                              â”‚
  â”‚  2ï¸âƒ£  fulfillment_processor_queue                            â”‚
  â”‚      â”œâ”€ Bound to: payments exchange                         â”‚
  â”‚      â”œâ”€ Consumer: fulfillment-service                       â”‚
  â”‚      â”œâ”€ Purpose: Create shipments for successful payments   â”‚
  â”‚      â””â”€ Durable: true                                       â”‚
  â”‚                                                              â”‚
  â”‚  3ï¸âƒ£  notifications_orders_queue                             â”‚
  â”‚      â”œâ”€ Bound to: orders exchange                           â”‚
  â”‚      â”œâ”€ Consumer: notification-service (thread 1)           â”‚
  â”‚      â”œâ”€ Purpose: Send order confirmation notifications      â”‚
  â”‚      â””â”€ Durable: true                                       â”‚
  â”‚                                                              â”‚
  â”‚  4ï¸âƒ£  notifications_payments_queue                           â”‚
  â”‚      â”œâ”€ Bound to: payments exchange                         â”‚
  â”‚      â”œâ”€ Consumer: notification-service (thread 2)           â”‚
  â”‚      â”œâ”€ Purpose: Send payment status notifications          â”‚
  â”‚      â””â”€ Durable: true                                       â”‚
  â”‚                                                              â”‚
  â”‚  5ï¸âƒ£  notifications_shipments_queue                          â”‚
  â”‚      â”œâ”€ Bound to: shipments exchange                        â”‚
  â”‚      â”œâ”€ Consumer: notification-service (thread 3)           â”‚
  â”‚      â”œâ”€ Purpose: Send shipment notifications                â”‚
  â”‚      â””â”€ Durable: true                                       â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SERVICE SPECIFICATIONS                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ”¹ Order Generator Service
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Language: Python 3.11                                       â”‚
  â”‚  Library: pika 1.3.2 (RabbitMQ client)                       â”‚
  â”‚  Replicas: 1                                                 â”‚
  â”‚  Namespace: order-pipeline                                   â”‚
  â”‚                                                              â”‚
  â”‚  Connection Pattern:                                         â”‚
  â”‚  â”œâ”€ Retry: 10 attempts with 5s delay                        â”‚
  â”‚  â”œâ”€ Heartbeat: 600s                                         â”‚
  â”‚  â””â”€ Timeout: 300s                                           â”‚
  â”‚                                                              â”‚
  â”‚  Sample Products:                                            â”‚
  â”‚  â”œâ”€ Laptop â‚¬999.99                                          â”‚
  â”‚  â”œâ”€ Smartphone â‚¬799.99                                      â”‚
  â”‚  â”œâ”€ Headphones â‚¬149.99                                      â”‚
  â”‚  â””â”€ 5 more items...                                         â”‚
  â”‚                                                              â”‚
  â”‚  Sample Customers:                                           â”‚
  â”‚  â”œâ”€ alice@example.com                                       â”‚
  â”‚  â”œâ”€ bob@example.com                                         â”‚
  â”‚  â””â”€ 4 more customers...                                     â”‚
  â”‚                                                              â”‚
  â”‚  Prometheus Metrics:                                         â”‚
  â”‚  â””â”€ orders_generated_total (Counter)                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ”¹ Payment Service
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Language: Python 3.11                                       â”‚
  â”‚  Replicas: 2 (Load balanced)                                 â”‚
  â”‚  Queue: payment_processor_queue                              â”‚
  â”‚  QoS: prefetch_count=1 (fair dispatch)                       â”‚
  â”‚                                                              â”‚
  â”‚  Processing Logic:                                           â”‚
  â”‚  â”œâ”€ Success: 90% probability                                â”‚
  â”‚  â”œâ”€ Failure: 10% probability                                â”‚
  â”‚  â”œâ”€ Duration: 0.5-2.0 seconds                               â”‚
  â”‚  â””â”€ Payment Methods: credit_card, paypal, bank_transfer     â”‚
  â”‚                                                              â”‚
  â”‚  Failure Reasons (Random):                                   â”‚
  â”‚  â”œâ”€ insufficient_funds                                      â”‚
  â”‚  â”œâ”€ card_expired                                            â”‚
  â”‚  â”œâ”€ fraud_detected                                          â”‚
  â”‚  â””â”€ network_error                                           â”‚
  â”‚                                                              â”‚
  â”‚  Prometheus Metrics:                                         â”‚
  â”‚  â”œâ”€ payments_processed_total{status} (Counter)              â”‚
  â”‚  â”œâ”€ payment_amount_total{status} (Counter)                  â”‚
  â”‚  â””â”€ payment_processing_duration_seconds (Histogram)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ”¹ Fulfillment Service
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Language: Python 3.11                                       â”‚
  â”‚  Replicas: 1                                                 â”‚
  â”‚  Queue: fulfillment_processor_queue                          â”‚
  â”‚  QoS: prefetch_count=1                                       â”‚
  â”‚                                                              â”‚
  â”‚  Processing Logic:                                           â”‚
  â”‚  â”œâ”€ Filter: Only successful payments                        â”‚
  â”‚  â”œâ”€ Skip: Failed payments (logged)                          â”‚
  â”‚  â”œâ”€ Duration: 1.0-3.0 seconds                               â”‚
  â”‚  â””â”€ Carriers: DHL, FedEx, UPS, USPS                         â”‚
  â”‚                                                              â”‚
  â”‚  Generates:                                                  â”‚
  â”‚  â”œâ”€ Tracking: TRACK-{order_id}-{timestamp}                  â”‚
  â”‚  â”œâ”€ Estimated delivery: 2-7 days                            â”‚
  â”‚  â””â”€ Shipment status: shipped                                â”‚
  â”‚                                                              â”‚
  â”‚  Prometheus Metrics:                                         â”‚
  â”‚  â”œâ”€ shipments_created_total (Counter)                       â”‚
  â”‚  â””â”€ fulfillment_processing_duration_seconds (Histogram)     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ”¹ Notification Service
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Language: Python 3.11                                       â”‚
  â”‚  Replicas: 1                                                 â”‚
  â”‚  Architecture: Multi-threaded (3 threads)                    â”‚
  â”‚  Queues: All 3 notification queues simultaneously            â”‚
  â”‚                                                              â”‚
  â”‚  Thread-Safety:                                              â”‚
  â”‚  â”œâ”€ Each thread: Separate RabbitMQ connection               â”‚
  â”‚  â”œâ”€ Each thread: Dedicated channel                          â”‚
  â”‚  â””â”€ No shared connection (prevents crashes)                 â”‚
  â”‚                                                              â”‚
  â”‚  Notification Types:                                         â”‚
  â”‚  â”œâ”€ order_confirmation: "Order #X received - â‚¬Y"            â”‚
  â”‚  â”œâ”€ payment_success: "Payment successful for order #X"      â”‚
  â”‚  â”œâ”€ payment_failed: "Payment failed: {reason}"              â”‚
  â”‚  â””â”€ shipment_notification: "Order shipped! Track: X"        â”‚
  â”‚                                                              â”‚
  â”‚  Prometheus Metrics:                                         â”‚
  â”‚  â””â”€ notifications_sent_total{type,topic} (Counter)          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GRAFANA DASHBOARD PANELS                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Dashboard: "RabbitMQ & Order Pipeline"
  Refresh: 10 seconds (real-time monitoring)
  Panels: 22 total (organized in 2 sections)

  ğŸ“Š Section 1: RabbitMQ Metrics (9 panels)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  1. Total Queued Messages (Stat)                            â”‚
  â”‚     â”œâ”€ Query: sum(rabbitmq_queue_messages)                  â”‚
  â”‚     â””â”€ Thresholds: Green<100, Yellow<1000, Redâ‰¥1000         â”‚
  â”‚                                                              â”‚
  â”‚  2. Messages Ready (Stat)                                   â”‚
  â”‚     â””â”€ Query: sum(rabbitmq_queue_messages_ready)            â”‚
  â”‚                                                              â”‚
  â”‚  3. Messages Unacknowledged (Stat)                          â”‚
  â”‚     â”œâ”€ Query: sum(rabbitmq_queue_messages_unacked)          â”‚
  â”‚     â””â”€ Thresholds: Green<50, Yellow<200, Redâ‰¥200            â”‚
  â”‚                                                              â”‚
  â”‚  4. Total Consumers (Stat)                                  â”‚
  â”‚     â”œâ”€ Query: sum(rabbitmq_queue_consumers)                 â”‚
  â”‚     â””â”€ Color: Red if 0, Green if â‰¥1                         â”‚
  â”‚                                                              â”‚
  â”‚  5. Queue Depths by Queue (Time Series)                     â”‚
  â”‚     â”œâ”€ Query: rabbitmq_queue_messages{queue=~".*_queue"}    â”‚
  â”‚     â””â”€ Shows: Each named queue depth over time              â”‚
  â”‚                                                              â”‚
  â”‚  6. Message Rate (Time Series)                              â”‚
  â”‚     â”œâ”€ Published: rate(messages_published_total[1m])        â”‚
  â”‚     â”œâ”€ Delivered: rate(messages_delivered_total[1m])        â”‚
  â”‚     â””â”€ Acknowledged: rate(messages_acked_total[1m])         â”‚
  â”‚                                                              â”‚
  â”‚  7. Connections & Channels (Time Series)                    â”‚
  â”‚     â”œâ”€ Connections: rabbitmq_connections                    â”‚
  â”‚     â””â”€ Channels: rabbitmq_channels                          â”‚
  â”‚                                                              â”‚
  â”‚  8. Memory Usage (Gauge)                                    â”‚
  â”‚     â”œâ”€ Query: rabbitmq_process_resident_memory_bytes/1024/1024â”‚
  â”‚     â”œâ”€ Unit: MB                                             â”‚
  â”‚     â””â”€ Thresholds: Green<700MB, Yellow<900MB, Redâ‰¥900MB     â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ“Š Section 2: Order Pipeline Metrics (13 panels)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  9. Orders Generated (Stat)                                 â”‚
  â”‚     â””â”€ Query: orders_generated_total                        â”‚
  â”‚                                                              â”‚
  â”‚  10. Payments Processed (Stat)                              â”‚
  â”‚      â””â”€ Query: sum(payments_processed_total)                â”‚
  â”‚                                                              â”‚
  â”‚  11. Shipments Created (Stat)                               â”‚
  â”‚      â””â”€ Query: shipments_created_total                      â”‚
  â”‚                                                              â”‚
  â”‚  12. Notifications Sent (Stat)                              â”‚
  â”‚      â””â”€ Query: sum(notifications_sent_total)                â”‚
  â”‚                                                              â”‚
  â”‚  13. Order Generation Rate (Time Series)                    â”‚
  â”‚      â””â”€ Query: rate(orders_generated_total[5m]) * 60        â”‚
  â”‚                                                              â”‚
  â”‚  14. Payment Success vs Failed (Time Series)                â”‚
  â”‚      â”œâ”€ Success: rate(payments_processed{status="success"}[5m])â”‚
  â”‚      â””â”€ Failed: rate(payments_processed{status="failed"}[5m])  â”‚
  â”‚                                                              â”‚
  â”‚  15. Payment Success Rate % (Gauge)                         â”‚
  â”‚      â”œâ”€ Query: (sum(success) / sum(total)) * 100            â”‚
  â”‚      â””â”€ Thresholds: Red<80%, Yellow<90%, Greenâ‰¥90%          â”‚
  â”‚                                                              â”‚
  â”‚  16. Total Revenue (Stat)                                   â”‚
  â”‚      â”œâ”€ Query: sum(payment_amount_total)                    â”‚
  â”‚      â”œâ”€ Unit: EUR                                           â”‚
  â”‚      â””â”€ Decimals: 2                                         â”‚
  â”‚                                                              â”‚
  â”‚  17. Payment Processing Time p95 (Gauge)                    â”‚
  â”‚      â”œâ”€ Query: histogram_quantile(0.95, payment_processing_duration)â”‚
  â”‚      â”œâ”€ Unit: seconds                                       â”‚
  â”‚      â””â”€ Thresholds: Green<1.5s, Yellow<2.5s, Redâ‰¥2.5s       â”‚
  â”‚                                                              â”‚
  â”‚  18. Fulfillment Processing Time p95 (Gauge)                â”‚
  â”‚      â”œâ”€ Query: histogram_quantile(0.95, fulfillment_processing_duration)â”‚
  â”‚      â”œâ”€ Unit: seconds                                       â”‚
  â”‚      â””â”€ Thresholds: Green<2s, Yellow<3s, Redâ‰¥3s             â”‚
  â”‚                                                              â”‚
  â”‚  19. Pipeline Throughput (Time Series)                      â”‚
  â”‚      â”œâ”€ Orders Generated                                    â”‚
  â”‚      â”œâ”€ Payments Success                                    â”‚
  â”‚      â”œâ”€ Shipments Created                                   â”‚
  â”‚      â””â”€ Notifications Sent                                  â”‚
  â”‚          (All rates per minute)                             â”‚
  â”‚                                                              â”‚
  â”‚  20. Service Health (Time Series)                           â”‚
  â”‚      â”œâ”€ Order Generator: up{job="order-generator"}          â”‚
  â”‚      â”œâ”€ Payment Service: up{job="payment-service"}          â”‚
  â”‚      â”œâ”€ Fulfillment Service: up{job="fulfillment-service"}  â”‚
  â”‚      â””â”€ Notification Service: up{job="notification-service"}â”‚
  â”‚          (Binary: 1=up, 0=down)                             â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ACCESS & MONITORING                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ° RabbitMQ Management UI
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  URL: http://rabbitmq.local:30683                           â”‚
  â”‚  Login: admin / ***                                         â”‚
  â”‚                                                              â”‚
  â”‚  Features:                                                   â”‚
  â”‚  â”œâ”€ Overview: Connections, channels, queues, messages/sec   â”‚
  â”‚  â”œâ”€ Connections: Active client connections                  â”‚
  â”‚  â”œâ”€ Channels: Open channels per connection                  â”‚
  â”‚  â”œâ”€ Exchanges: orders, payments, shipments (fanout)         â”‚
  â”‚  â”œâ”€ Queues: 5 named queues with depths & consumers          â”‚
  â”‚  â””â”€ Admin: User management, vhosts, policies                â”‚
  â”‚                                                              â”‚
  â”‚  Note: Add to Windows hosts file:                           â”‚
  â”‚  <cluster-ip> rabbitmq.local                                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ“Š Grafana Dashboard
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  URL: http://grafana.local:30683                            â”‚
  â”‚  Dashboard: "RabbitMQ & Order Pipeline"                     â”‚
  â”‚                                                              â”‚
  â”‚  View:                                                       â”‚
  â”‚  â”œâ”€ Real-time message flow                                  â”‚
  â”‚  â”œâ”€ Queue depths and backlogs                               â”‚
  â”‚  â”œâ”€ Payment success/failure rates                           â”‚
  â”‚  â”œâ”€ Processing time latencies                               â”‚
  â”‚  â”œâ”€ Total revenue generated                                 â”‚
  â”‚  â””â”€ Service health status                                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ“ˆ Prometheus Metrics
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  RabbitMQ Scrape Target:                                    â”‚
  â”‚  â””â”€ rabbitmq.rabbitmq.svc.cluster.local:15692/metrics       â”‚
  â”‚                                                              â”‚
  â”‚  Service Scrape Targets:                                    â”‚
  â”‚  â”œâ”€ order-generator:8000/metrics                            â”‚
  â”‚  â”œâ”€ payment-service:8001/metrics                            â”‚
  â”‚  â”œâ”€ fulfillment-service:8002/metrics                        â”‚
  â”‚  â””â”€ notification-service:8003/metrics                       â”‚
  â”‚                                                              â”‚
  â”‚  Scrape Interval: 30 seconds                                â”‚
  â”‚  Retention: 2 days                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RELIABILITY FEATURES                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  âœ… Connection Resilience
  â”œâ”€ Automatic retry: 10 attempts with 5s backoff
  â”œâ”€ Heartbeat monitoring: 600s keepalive
  â”œâ”€ Connection timeout: 300s
  â””â”€ Graceful reconnection on network issues

  âœ… Message Durability
  â”œâ”€ Durable queues: Survive RabbitMQ restarts
  â”œâ”€ Durable exchanges: Persist configuration
  â”œâ”€ Message acknowledgment: Manual ack/nack
  â””â”€ Failed messages: Logged and rejected (no requeue)

  âœ… Load Balancing
  â”œâ”€ Payment service: 2 replicas for high availability
  â”œâ”€ Fair dispatch: QoS prefetch_count=1
  â”œâ”€ Round-robin: RabbitMQ distributes evenly
  â””â”€ No single point of failure

  âœ… Error Handling
  â”œâ”€ Try-catch blocks: All message processing
  â”œâ”€ Structured logging: JSON format with context
  â”œâ”€ Failed payment tracking: Separate metric labels
  â””â”€ Dead letter handling: Rejected messages logged

  âœ… Thread Safety
  â”œâ”€ Notification service: Separate connection per thread
  â”œâ”€ No shared state: Each thread independent
  â””â”€ Prevents: Pika BlockingConnection crashes


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DEPLOYMENT FILES                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ“ apps/rabbitmq/
  â”œâ”€ namespace.yaml           â† rabbitmq namespace
  â”œâ”€ deployment.yaml          â† RabbitMQ pod with management plugin
  â”œâ”€ service.yaml             â† Exposes AMQP, management, metrics
  â”œâ”€ ingress.yaml             â† Traefik ingress for management UI
  â””â”€ kustomization.yaml       â† GitOps configuration

  ğŸ“ apps/order-pipeline/
  â”œâ”€ namespace.yaml           â† order-pipeline namespace
  â”œâ”€ configmap.yaml           â† All 4 service Python code (446 lines)
  â”œâ”€ deployments.yaml         â† 4 service deployments
  â”œâ”€ services.yaml            â† 4 metrics endpoints
  â””â”€ kustomization.yaml       â† GitOps configuration

  Total: 10 files, ~1400 lines of infrastructure + application code
  Deployment: Automatic via Flux CD (GitOps)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TECHNICAL DECISIONS                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â“ Why RabbitMQ instead of Kafka?
  â”œâ”€ ARM32 Compatibility: Kafka images don't support ARMv7
  â”œâ”€ Lightweight: RabbitMQ requires less resources (512Mi vs 2Gi+)
  â”œâ”€ Simpler setup: No Zookeeper needed
  â””â”€ Alpine image: rabbitmq:3.13-management-alpine (ARM32 ready)

  â“ Why Fanout Exchanges?
  â”œâ”€ Broadcast pattern: Multiple consumers per message
  â”œâ”€ Simple routing: No complex rules needed
  â”œâ”€ Decoupling: Services don't know about each other
  â””â”€ Easy expansion: Add new consumers without changes

  â“ Why Named Queues?
  â”œâ”€ Visibility: Easy to identify in RabbitMQ UI
  â”œâ”€ Monitoring: Better dashboard filtering
  â”œâ”€ Debugging: Clear queue purpose
  â””â”€ Durable: Survive pod restarts

  â“ Why ConfigMap for Code?
  â”œâ”€ GitOps: Single source of truth in Git
  â”œâ”€ No registry: No need for Docker Hub/private registry
  â”œâ”€ Fast updates: Change code + git push = auto-deploy
  â””â”€ ARM32 base: Use standard python:3.11-slim (ARM compatible)

  â“ Why Separate Connection per Thread?
  â”œâ”€ Pika limitation: BlockingConnection not thread-safe
  â”œâ”€ Crash prevention: Prevents StreamLostError
  â”œâ”€ Independence: Each thread fully isolated
  â””â”€ Reliability: One thread failure doesn't affect others

  â“ Why 90% Payment Success Rate?
  â”œâ”€ Realistic simulation: Real-world failure scenarios
  â”œâ”€ Monitoring test: Validates alerting on failures
  â”œâ”€ Dashboard testing: Success/failure visualization
  â””â”€ Error handling: Exercises failure code paths
```

---

**Created:** 2026-01-04
**Last Updated:** 2026-01-07
**Cluster:** 2x Raspberry Pi (ARMv7)
**GitOps:** Flux CD
**Monitoring:** Prometheus + Grafana + Loki + Custom Apps
**Applications:** SmartBiz (PostgreSQL + FastAPI + SPA)
**Public Access:** Cloudflare Tunnel
